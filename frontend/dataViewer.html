<!-- <META HTTP-EQUIV="refresh" CONTENT="2"> -->
<script src="https://code.jquery.com/jquery-3.4.1.slim.min.js"
    integrity="sha384-J6qa4849blE2+poT4WnyKhv5vZF5SrPo0iEjwBvKU7imGFAV0wwj1yYfoRSJoZ+n"
    crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js"
    integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo"
    crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js"
    integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6"
    crossorigin="anonymous"></script>
<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css"
    integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">
<script src="https://unpkg.com/axios/dist/axios.min.js"></script>
<script src="https://code.jquery.com/jquery-3.3.1.min.js"
    integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"
    integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1"
    crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"
    integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM"
    crossorigin="anonymous"></script>
<html>
<style>
    #container {
        margin: auto;
        width: 80%;
        height: 80%;
        background-color: white;
        border-radius: 10px;
    }

    #header {
        margin: auto;
        padding-top: 10px;
        width: 95%;
        /* background-color: red; */
    }

    .bg {
        background-image: url("./images/grey.png");
        height: 100%;
        background-position: center;
        background-repeat: no-repeat;
        background-size: cover;
    }

    #navBarAttribute {
        width: 150px !important;
    }

    #navBarOperation {
        width: 75px !important;
    }

    #navBaruserInput {
        width: 150px !important;
    }

    /* Search button for navbar */
    #searchButton {
        padding: 15px 15px !important;
        text-align: center;
        text-decoration: none;
        margin: 5px 20px 30px;
        cursor: pointer;
    }

    #size {
        padding: 15px 10px 0px
    }

    #resultrow {
        background-color: red;
    }
</style>
<box>
    Data Result

    <body style="background-color:  #e6e6e6;">
        <div class="container" id=container>
            <div class="row">
                <!--Header -->
                <div class="row" id=header>
                    <div class="col-sm-2">
                        <th>MusicDb</th>
                    </div>
                    <div class="entries_length"><label>Show
                            <select id="entry_length" aria-controls="example"
                                class="custom-select custom-select-sm form-control-sm">
                                <option value="5">5</option>
                                <option value="15">15</option>
                                <option value="25">25</option>
                                <option value="30">30</option>
                            </select> entries
                        </label></div>

                    <div class="col-sm-1" id="size">Search</div>

                    <div class="entries_length" id="size">
                        <select name="attribute" aria-controls="example" class="form-control" id="attribute">
                            <option value="performanceId">performanceId</option>
                            <option value="festivalId">festivalId</option>
                            <option value="startTime">startTime</option>
                            <option value="endTime">endTime</option>
                            <option value="popularity">popularity</option>
                            <option value="dataInserted">dataInserted</option>
                        </select></div>

                    <div class="entries_length" id="size">
                        <select name="operation" aria-controls="example" class="form-control" id="operation">
                            <option value=null>all</option>
                            <option value="=">==</option>
                            <option value="=">&gt;=</option>
                            <option value=">">&gt;</option>
                            <option value="<">&lt;</option>
                            <option value="<=">&lt;=</option>
                        </select></div>

                    <div id="size"><input class="form-control" type="text" placeholder="Search" id="navBaruserInput"
                            aria-label="Search">
                    </div>
                    <button type="button" id="SearchButton">Filter</button>
                </div>



                <table style="width: 100%;" id="example"
                    class="table table-hover table-striped table-bordered dataTable dtr-inline" role="grid"
                    aria-describedby="example_info">

                    <thead>
                        <tr>
                            <div class="col-sm-1"></div>

                            <div class="col-sm-10" id="columnHeader">
                            </div>
                            <div class="col-sm-1"></div>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <div class="col-sm-1"></div>

                            <div class="col-sm-10" id="results">
                            </div>

                            <div class="col-sm-1"></div>
                        </tr>
                    </tbody>
                </table>

                <div class="col-sm-12 col-md-5">
                    <div class="dataTables_info" id="recordCount" role="status" aria-live="polite"></div>
                </div>
            </div>

            <!-- <div class="col-sm-10" id="results" id="resultrow">
                    </div> -->

        </div>
        <div class="row">
            <div class="col-sm-12 col-md-5">
            </div>
            <div class="col-sm-12 col-md-7" styles="width:50%;margin:0 auto">

                <div class="dataTables_paginate paging_simple_numbers" id="example_paginate">
                    <ul class="pagination">
                        <li class="paginate_button page-item previous disabled" id="example_previous"><a href="#"
                                aria-controls="example" data-dt-idx="0" tabindex="0" class="page-link">Previous</a>
                        </li>
                        <div id="testing"></div>
                        <!-- <li class="paginate_button page-item active"><a href="#" aria-controls="example" data-dt-idx="1"
                                tabindex="0" class="page-link">1</a></li>
                        <li class="paginate_button page-item "><a href="#" aria-controls="example" data-dt-idx="2"
                                tabindex="0" class="page-link">2</a></li>
                        <li class="paginate_button page-item "><a href="#" aria-controls="example" data-dt-idx="3"
                                tabindex="0" class="page-link">3</a></li>
                        <li class="paginate_button page-item "><a href="#" aria-controls="example" data-dt-idx="4"
                                tabindex="0" class="page-link">4</a></li>
                        <li class="paginate_button page-item "><a href="#" aria-controls="example" data-dt-idx="5"
                                tabindex="0" class="page-link">5</a></li>
                        <li class="paginate_button page-item "><a href="#" aria-controls="example" data-dt-idx="6"
                                tabindex="0" class="page-link">6</a></li> -->
                        <li class="paginate_button page-item next" id="example_next"><a href="#" aria-controls="example"
                                data-dt-idx="7" tabindex="0" class="page-link">Next</a></li>
                    </ul>
                </div>

            </div>
        </div>
    </body>
</box>
<script>
    const baseUrl = "http://localhost:8011";
    var recordCountt;


    var entry_length = 5
    count = 0

    //get the row length
    $("#SearchButton").click(function () {
        //get input from user        
        var userInput = $('#navBaruserInput').val()
        if (userInput == "" || userInput == null) {
            userInput = null
        }

        var Info = {
            attribute: $('#attribute').val(),
            operation: $('#operation').val(),
            userInput: userInput,
            // order: "desc",
            orderFrom: "popularity"
        }
        count++
        entry_length = $('#entry_length').val();
        getData(entry_length, Info)
        recordCount()
        localStorage.setItem('recordCount', entry_length)
        // bottomTag = (totalInsert % entry_length) + 1
        // console.log(bottomTag)
        if (count > 1) window.location.reload();

    })

    // post to get the data information
    function getData(length, Info) {
        Infos = JSON.stringify(Info)
        $.ajax({
            url: 'http://localhost:8011/advance/result',
            type: 'post',
            data: Infos,
            contentType: "application/json; charset=utf-8",
            dataType: 'json',
            success: function (data, textStatus, xhr) {
                for (i = 0; i < length; i++) {
                    const postHtml =
                        `
                <tr>
                <td class="sorting_asc  table table-hover table-striped table-bordered dataTable dtr-inline" tabindex="0" aria-controls="example" rowspan="1"
                style="width: 585.2px;text-align:center" 
                aria-label="Name: activate to sort column descending">${data[i].performanceId}</td>
                <td class="sorting_asc  table table-hover table-striped table-bordered dataTable dtr-inline" tabindex="0" aria-controls="example" rowspan="1"
                style="width: 585.2px;text-align:center" 
                aria-label="Name: activate to sort column descending">${data[i].festivalId}</td>
                <td class="sorting_asc  table table-hover table-striped table-bordered dataTable dtr-inline" tabindex="0" aria-controls="example" rowspan="1"
                style="width: 585.2px;text-align:center" 
                aria-label="Name: activate to sort column descending">${data[i].startTime}</td>
                <td class="sorting_asc  table table-hover table-striped table-bordered dataTable dtr-inline" tabindex="0" aria-controls="example" rowspan="1"
                style="width: 585.2px;text-align:center" 
                aria-label="Name: activate to sort column descending">${data[i].endTime}</td>
                <td class="sorting_asc  table table-hover table-striped table-bordered dataTable dtr-inline" tabindex="0" aria-controls="example" rowspan="1"
                style="width: 585.2px;text-align:center" 
                aria-label="Name: activate to sort column descending">${data[i].popularity}</td>
                </tr>
                `    ;
                    $("#results").append(postHtml);
                }

            },
            error: function (xhr, textStatus, errorThrown) {
                console.log('Error in Operation');
            }
        });
    }

    //Axios code to get the number of record counts
    function recordCount() {
        axios.get(`${baseUrl}/advance/recordCount`)
            .then((response) => {
                const recordcount = response.data;
                {
                    const postHtml = `                            
                <div class="dataTables_info" role="status" aria-live="polite">     Showing 1 to ${entry_length} of
                    ${recordcount[0].recordCount}
                    entries</div>
                `
                    $("#recordCount").append(postHtml);
                    recordCountt = recordcount[0].recordCount

                    bottomTag = Math.ceil(recordCountt / entry_length)
                    console.log(bottomTag) //extra tabs 2

                    const header = response.data;
                    console.log(response.data)

                    var tfsadfsfsad=""
                    for (i = 1; i <= bottomTag; i++) {
                        tfsadfsfsad+= `
                            <li class="paginate_button page-item active"><a href="#" aria-controls="example" data-dt-idx="1"
                            tabindex="0" class="page-link">${i}</a></li>                
                                        `
                    }
                    $("#testing").append(tfsadfsfsad);



                    // return recordCountt
                };
                // return "her3"
            })
            .catch((error) => {
                console.log(error);
            });
        setTimeout(function () { console.log(recordCountt); return recordCountt }, 1000);


    }



    //Axios code to get the header
    axios.get(`${baseUrl}/advance/header`)
        .then((response) => {
            const header = response.data;
            // console.log(listings)
            header.forEach((header) => {
                const postHtml = `
                <th class="sorting_asc  table table-hover table-striped table-bordered dataTable dtr-inline" tabindex="0" aria-controls="example" rowspan="1"
                style="width: 585.2px;text-align:center" 
                aria-label="Name: activate to sort column descending">${header.COLUMN_NAME}</th>
                
                `
                $("#columnHeader").append(postHtml);
            });
        })
        .catch((error) => {
            console.log(error);
        });





</script>

</html>